---
title: 详解https
cover: false
categories:
  - 前端
  - 网络协议
tags:
  - http
  - https
  - 对称加密
  - 非对称加密
abbrlink: 8cf97bfb
date: 2020-08-17 22:33:53
---
HTTPS，超文本传输安全协议（HyperText Transfer Protocol Secure），简单来说属于HTTP的安全版本，通过在HTTP的基础上，经传输层安全协议SSL/TLS加密封包，建立一条安全的通信通道。
> SSL/TLS属于在TCP协议之上，HTTP协议之下的一个中间层协议。

要想让 HTTP 更安全，只能使用真正的加密算法，因为加密算法可以用密钥加密或还原数据，只要**确保密钥不被第三方获取**，那就能确保数据传输的安全了。
> https中的非对称加密正是用来确保密钥不被第三方获取。

### http和https的不同（优劣势对比）
- http默认使用80端口；https默认使用443端口。
- http的明文传输数据，不安全，不适合传输敏感数据；https通过ssl加密传输数据。
- http是简单的，无状态的；https提供加密传输，数据校验，身份认证的。
- https协议需要收费的ca申请证书，免费的较少。
- 采用https的网站更加受谷歌SEO策略的青睐，但同时受制于建立连接的过程复杂，所以需要更多的数据开销和功耗，而http请求和响应的速度要快很多。
- https也并非绝对安全，面对黑客攻击，ddos攻击，https也束手无策。
- https使用的ssl证书，信用链体系并不安全，对于掌握ca根证书的国家，或者发布证书和密钥算法的组织，也可能作为中间人攻击。

### 加密算法
HTTPS 解决数据传输安全问题的方案就是使用混合加密算法，也就是对称加密和非对称加密的混合使用。
#### 对称加密
加密和解密都是使用同一个密钥：
- 优点：算法公开、计算量小、加密速度快、加密效率高，适合加密比较大的数据
- 缺点：每次使用都需要不同的密钥，密钥管理困难，使用成本较高，传输过程可能会被截获

对称加密的主要不安全问题在于密钥本身需要在传输数据之前，先由一方把密钥传给另一方，那么在此过程中密钥就很有可能被截获。
#### 非对称加密
加密和解密不是使用同一个密钥：
- 优点：算法公开，加密和解密使用不同的钥匙，私钥不需要通过网络进行传输，安全性很高。
- 缺点：计算量比较大，加密和解密速度相比对称加密慢很多。

非对称加密关键在于私钥只有自己拥有，数据只能自己解密。
非对称加密可以解决对称加密传输密钥过程被截获破解的问题
> 甲方生成的公钥传递给乙方，乙方通过公钥加密对称加密用到的密钥再传输给甲方，甲方用独有的私钥解密（私钥不被传输）。

### https的工作原理（过程）
流程包括证书验证和数据传输（非对称加密和对称加密）两个大过程，原理简单概括就是：用非对称加密传输交换对称加密的密钥。
<center>
    <img style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);display:inline;margin:0" 
    src="https://cdn.jsdelivr.net/gh/DSzhongweizi/Resources/article/20200822145621.png" width=700 />
    <br>
    <div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;">https过程原理</div>
</center>

1. 客户端向服务器发起https请求
2. 服务器响应请求，返回包含公钥的证书（私钥由服务器保存，不公布）
3. 客户端验证证书，证书本身也附带一个证书电子签名，这个签名用来验证证书的完整性和真实性，可以防止证书被篡改。
4. 证书没有问题后通过包含的公钥生成一个随机码，并用该公钥继续加密随机码（对称加密的密钥），发送给服务端
5. 服务器用保存的私钥解密得到随机码，并用该随机码对传输数据加密
6. 客户端用随机码解密数据

整个数据传输过程，关键在于服务器拥有非对称加密的私钥（客户端没有），并通过该私钥来保证对称加密用到的密钥（随机码）不被劫持篡改。

